# topology configuration
config:
  topology.parallelism: {{ getv "/kilda_storm_parallelism_level" }}
  topology.workers: {{ getv "/kilda_storm_parallelism_workers_count" }}

{{- if exists "/kilda_storm_disruptor_wait_timeout" }}
  # Configure timeout milliseconds used for disruptor queue wait strategy. Can be used to tradeoff latency vs. CPU usage.
  topology.disruptor.wait.timeout.millis : {{ getv "/kilda_storm_disruptor_wait_timeout" }}
{{- end }}
{{- if exists "/kilda_storm_disruptor_batch_timeout" }}
  # The maximum age in milliseconds a batch can be before being sent to the next thread.
  topology.disruptor.batch.timeout.millis : {{ getv "/kilda_storm_disruptor_batch_timeout" }}
{{- end }}
{{- if exists "/kilda_storm_spout_wait_sleep_timeout" }}
  topology.spout.wait.strategy : org.apache.storm.spout.SleepSpoutWaitStrategy
  # The amount of milliseconds a spout should sleep when emits no tuples.
  topology.sleep.spout.wait.strategy.time.ms : {{ getv "/kilda_storm_spout_wait_sleep_timeout" }}
{{- end }}

# spout definitions
spouts:
  - id: "kilda.otsdb-spout"
    parallelism: {{ getv "/kilda_opentsdb_num_spouts" }}

# bolt definitions
bolts:
  - id: "DatapointParseBolt"
    parallelism: {{ getv "/kilda_opentsdb_num_datapointparserbolt" }}
    numTasks: {{ getv "/kilda_opentsdb_workers_datapointparserbolt" }}
  - id: "OpenTSDBFilterBolt"
    parallelism: {{ getv "/kilda_opentsdb_num_opentsdbfilterbolt" }}
  - id: "otsdb-bolt"
    parallelism: {{ getv "/kilda_opentsdb_num_opentsdbbolt" }}
    numTasks: {{ getv "/kilda_opentsdb_workers_opentsdbolt" }}
